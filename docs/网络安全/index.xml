<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>自在网站 – 网络安全</title>
    <link>http://localhost:8081/docs/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/</link>
    <description>Recent content in 网络安全 on 自在网站</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cn</language>
    <lastBuildDate>Mon, 29 Dec 2025 11:17:13 +0800</lastBuildDate>
    
	  <atom:link href="http://localhost:8081/docs/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/index.xml" rel="self" type="application/rss+xml" />
    
    
      
        
      
    
    
    <item>
      <title>Iptables之nat配置</title>
      <link>http://localhost:8081/docs/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/iptables%E4%B9%8Bnat%E9%85%8D%E7%BD%AE/</link>
      <pubDate>Mon, 29 Dec 2025 14:57:35 +0800</pubDate>
      
      <guid>http://localhost:8081/docs/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/iptables%E4%B9%8Bnat%E9%85%8D%E7%BD%AE/</guid>
      <description>
        
        
        &lt;h2&gt;核心概念先明确&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;核心概念先明确&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e6%a0%b8%e5%bf%83%e6%a6%82%e5%bf%b5%e5%85%88%e6%98%8e%e7%a1%ae&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;SNAT（Source NAT）&lt;/strong&gt;：修改数据包的&lt;strong&gt;源 IP&lt;/strong&gt;，用于内网主机通过网关服务器访问外网（解决内网 IP 无法直接路由的问题）。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;DNAT（Destination NAT）&lt;/strong&gt;：修改数据包的&lt;strong&gt;目标 IP / 端口&lt;/strong&gt;，用于将外网请求映射到内网服务器（如发布内网服务到公网）。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;前提条件：网关服务器需开启 IP 转发功能（必须先配置，否则 NAT 不生效）。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;基础准备：开启 IP 转发（所有场景必做）&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;基础准备开启-ip-转发所有场景必做&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%9f%ba%e7%a1%80%e5%87%86%e5%a4%87%e5%bc%80%e5%90%af-ip-%e8%bd%ac%e5%8f%91%e6%89%80%e6%9c%89%e5%9c%ba%e6%99%af%e5%bf%85%e5%81%9a&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;h3&gt;1. 临时开启（重启失效，用于测试）&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;1-临时开启重启失效用于测试&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#1-%e4%b8%b4%e6%97%b6%e5%bc%80%e5%90%af%e9%87%8d%e5%90%af%e5%a4%b1%e6%95%88%e7%94%a8%e4%ba%8e%e6%b5%8b%e8%af%95&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; &amp;gt; /proc/sys/net/ipv4/ip_forward&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;复制代码&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3&gt;2. 永久开启（重启生效，生产环境推荐）&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;2-永久开启重启生效生产环境推荐&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#2-%e6%b0%b8%e4%b9%85%e5%bc%80%e5%90%af%e9%87%8d%e5%90%af%e7%94%9f%e6%95%88%e7%94%9f%e4%ba%a7%e7%8e%af%e5%a2%83%e6%8e%a8%e8%8d%90&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;编辑内核参数配置文件：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div class=&#34;hextra-code-filename not-prose&#34; dir=&#34;auto&#34;&gt;/etc/sysctl.conf&lt;/div&gt;&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;net.ipv4.ip_forward &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-8&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;复制代码&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;生效配置：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sysctl -p&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;复制代码&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;场景 1：SNAT 配置（内网主机通过网关访问外网）&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;场景-1snat-配置内网主机通过网关访问外网&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%9c%ba%e6%99%af-1snat-%e9%85%8d%e7%bd%ae%e5%86%85%e7%bd%91%e4%b8%bb%e6%9c%ba%e9%80%9a%e8%bf%87%e7%bd%91%e5%85%b3%e8%ae%bf%e9%97%ae%e5%a4%96%e7%bd%91&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;h3&gt;环境假设&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;环境假设&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e7%8e%af%e5%a2%83%e5%81%87%e8%ae%be&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;网关服务器有两块网卡：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;内网网卡：&lt;code&gt;eth1&lt;/code&gt;，IP：&lt;code&gt;192.168.1.2&lt;/code&gt;（内网网段：&lt;code&gt;192.168.1.0/24&lt;/code&gt;）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;外网网卡：&lt;code&gt;eth0&lt;/code&gt;，IP：&lt;code&gt;203.0.113.10&lt;/code&gt;（公网 IP，可访问互联网）&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;内网主机：&lt;code&gt;192.168.1.100&lt;/code&gt;（重要：网关指向 &lt;code&gt;192.168.1.2&lt;/code&gt;）&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;需求&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;需求&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e9%9c%80%e6%b1%82&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;内网主机（192.168.1.100）通过网关服务器的公网 IP（203.0.113.10）访问外网，外网返回的数据通过网关转发回内网主机。&lt;/p&gt;
&lt;h3&gt;配置命令（SNAT 两种常用方式）&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;配置命令snat-两种常用方式&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e9%85%8d%e7%bd%ae%e5%91%bd%e4%bb%a4snat-%e4%b8%a4%e7%a7%8d%e5%b8%b8%e7%94%a8%e6%96%b9%e5%bc%8f&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;h4&gt;方式 1：固定公网 IP 场景（网关有静态公网 IP）&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;方式-1固定公网-ip-场景网关有静态公网-ip&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e6%96%b9%e5%bc%8f-1%e5%9b%ba%e5%ae%9a%e5%85%ac%e7%bd%91-ip-%e5%9c%ba%e6%99%af%e7%bd%91%e5%85%b3%e6%9c%89%e9%9d%99%e6%80%81%e5%85%ac%e7%bd%91-ip&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;# 配置 SNAT：内网网段 192.168.1.0/24 的流量，源 IP 替换为网关外网 IP（203.0.113.10）

iptables -t nat -A POSTROUTING -s 192.168.1.0/24 -o eth0 -j SNAT --to-source 203.0.113.10&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;复制代码&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h4&gt;方式 2：动态公网 IP 场景（网关拨号上网，IP 不固定）&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;方式-2动态公网-ip-场景网关拨号上网ip-不固定&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e6%96%b9%e5%bc%8f-2%e5%8a%a8%e6%80%81%e5%85%ac%e7%bd%91-ip-%e5%9c%ba%e6%99%af%e7%bd%91%e5%85%b3%e6%8b%a8%e5%8f%b7%e4%b8%8a%e7%bd%91ip-%e4%b8%8d%e5%9b%ba%e5%ae%9a&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;用 &lt;code&gt;MASQUERADE&lt;/code&gt; 替代 &lt;code&gt;SNAT&lt;/code&gt;，自动适配公网 IP 变化：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;# 动态伪装内网 IP，适用于 ADSL 拨号、DHCP 获取公网 IP 的场景

iptables -t nat -A POSTROUTING -s 192.168.1.0/24 -o eth0 -j MASQUERADE&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;复制代码&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3&gt;关键参数说明&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;关键参数说明&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%85%b3%e9%94%ae%e5%8f%82%e6%95%b0%e8%af%b4%e6%98%8e&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;参数&lt;/th&gt;
          &lt;th&gt;作用&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;-t nat&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;指定操作 nat 表（SNAT/DNAT 均在 nat 表中配置）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;-A POSTROUTING&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;在 POSTROUTING 链添加规则（数据包路由后、发送前修改源 IP）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;-s 192.168.1.0/24&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;匹配内网网段（仅对该网段的流量生效）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;-o eth0&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;指定出站网卡（即网关的外网网卡）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;--to-source 203.0.113.10&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;替换后的源 IP（网关公网 IP）&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;验证方法&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;验证方法&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e9%aa%8c%e8%af%81%e6%96%b9%e6%b3%95&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;内网主机（192.168.1.100）执行 ping 测试：&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;ping 223.5.5.5  #  ping 阿里云 DNS，测试外网连通性&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;复制代码&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;ol&gt;
&lt;li&gt;网关服务器查看 nat 表规则：&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;iptables -t nat -L POSTROUTING -n  # 查看 SNAT 规则是否存在&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;复制代码&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;ol&gt;
&lt;li&gt;外网服务器查看访问日志（如 Web 服务器），会显示访问源 IP 为网关公网 IP（203.0.113.10）。&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;场景 2：DNAT 配置（外网访问内网服务，端口映射）&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;场景-2dnat-配置外网访问内网服务端口映射&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%9c%ba%e6%99%af-2dnat-%e9%85%8d%e7%bd%ae%e5%a4%96%e7%bd%91%e8%ae%bf%e9%97%ae%e5%86%85%e7%bd%91%e6%9c%8d%e5%8a%a1%e7%ab%af%e5%8f%a3%e6%98%a0%e5%b0%84&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;h3&gt;环境假设&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;环境假设-1&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e7%8e%af%e5%a2%83%e5%81%87%e8%ae%be-1&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;网关服务器：外网网卡 &lt;code&gt;eth0&lt;/code&gt;（IP：203.0.113.10），内网网卡 &lt;code&gt;eth1&lt;/code&gt;（IP：192.168.1.1）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;内网服务器：&lt;code&gt;192.168.1.200&lt;/code&gt;（提供 Web 服务，端口 80；SSH 服务，端口 22）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;需求：&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;外网用户访问网关公网 IP 的 80 端口 → 转发到内网 192.168.1.200:80（Web 服务）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;外网用户访问网关公网 IP 的 2222 端口 → 转发到内网 192.168.1.200:22（SSH 服务，避免直接暴露 22 端口）&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;配置命令（DNAT 端口映射）&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;配置命令dnat-端口映射&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e9%85%8d%e7%bd%ae%e5%91%bd%e4%bb%a4dnat-%e7%ab%af%e5%8f%a3%e6%98%a0%e5%b0%84&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;h4&gt;1. Web 服务映射（80 端口）&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;1-web-服务映射80-端口&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#1-web-%e6%9c%8d%e5%8a%a1%e6%98%a0%e5%b0%8480-%e7%ab%af%e5%8f%a3&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;# DNAT：外网访问 203.0.113.10:80 → 转发到内网 192.168.1.200:80

iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 80 -j DNAT --to-destination 192.168.1.200:80&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;复制代码&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h4&gt;2. SSH 服务映射（2222 端口映射到 22 端口）&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;2-ssh-服务映射2222-端口映射到-22-端口&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#2-ssh-%e6%9c%8d%e5%8a%a1%e6%98%a0%e5%b0%842222-%e7%ab%af%e5%8f%a3%e6%98%a0%e5%b0%84%e5%88%b0-22-%e7%ab%af%e5%8f%a3&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;# DNAT：外网访问 203.0.113.10:2222 → 转发到内网 192.168.1.200:22

iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 2222 -j DNAT --to-destination 192.168.1.200:22&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;复制代码&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h4&gt;3. 可选：放行对应端口的入站流量（避免被默认策略拦截）&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;3-可选放行对应端口的入站流量避免被默认策略拦截&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#3-%e5%8f%af%e9%80%89%e6%94%be%e8%a1%8c%e5%af%b9%e5%ba%94%e7%ab%af%e5%8f%a3%e7%9a%84%e5%85%a5%e7%ab%99%e6%b5%81%e9%87%8f%e9%81%bf%e5%85%8d%e8%a2%ab%e9%bb%98%e8%ae%a4%e7%ad%96%e7%95%a5%e6%8b%a6%e6%88%aa&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;若网关 INPUT 链默认策略为 DROP，需放行映射的端口：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;# 放行外网访问 80 端口

iptables -A INPUT -i eth0 -p tcp --dport 80 -j ACCEPT

# 放行外网访问 2222 端口

iptables -A INPUT -i eth0 -p tcp --dport 2222 -j ACCEPT

# 放行已建立的连接（确保返回数据能通过）

iptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;复制代码&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3&gt;关键参数说明&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;关键参数说明-1&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%85%b3%e9%94%ae%e5%8f%82%e6%95%b0%e8%af%b4%e6%98%8e-1&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;参数&lt;/th&gt;
          &lt;th&gt;作用&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;-A PREROUTING&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;在 PREROUTING 链添加规则（数据包路由前修改目标 IP / 端口）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;-i eth0&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;指定入站网卡（即网关的外网网卡，仅匹配外网请求）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;--dport 80&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;匹配外网请求的目标端口（网关公网 IP 的端口）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;--to-destination 192.168.1.200:80&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;转发后的内网服务器 IP 和端口&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;验证方法&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;验证方法-1&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e9%aa%8c%e8%af%81%e6%96%b9%e6%b3%95-1&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;外网主机测试 Web 服务：&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;curl http://203.0.113.10  # 应返回内网 192.168.1.200 的 Web 页面&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;复制代码&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;ol&gt;
&lt;li&gt;外网主机测试 SSH 服务：&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;ssh -p 2222 用户名@203.0.113.10  # 应连接到内网 192.168.1.200 的 SSH&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;复制代码&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;ol&gt;
&lt;li&gt;网关查看 DNAT 规则和连接状态：&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;iptables -t nat -L PREROUTING -n  # 查看 DNAT 规则

netstat -an | grep :80            # 查看 80 端口连接（应显示内网服务器的连接）&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;复制代码&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;重要操作：保存 NAT 规则（避免重启失效）&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;重要操作保存-nat-规则避免重启失效&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e9%87%8d%e8%a6%81%e6%93%8d%e4%bd%9c%e4%bf%9d%e5%ad%98-nat-%e8%a7%84%e5%88%99%e9%81%bf%e5%85%8d%e9%87%8d%e5%90%af%e5%a4%b1%e6%95%88&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;h3&gt;CentOS/RHEL 系统&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;centosrhel-系统&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#centosrhel-%e7%b3%bb%e7%bb%9f&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;# 保存规则到配置文件

iptables-save &amp;gt; /etc/sysconfig/iptables

# 开机自启 iptables

systemctl enable iptables &amp;amp;&amp;amp; systemctl restart iptables&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;复制代码&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3&gt;Ubuntu/Debian 系统&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;ubuntudebian-系统&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#ubuntudebian-%e7%b3%bb%e7%bb%9f&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;# 安装规则持久化工具

apt-get install -y iptables-persistent

# 保存规则（自动写入 /etc/iptables/rules.v4）

netfilter-persistent save&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;复制代码&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;常见问题与注意事项&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;常见问题与注意事项&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%b8%b8%e8%a7%81%e9%97%ae%e9%a2%98%e4%b8%8e%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;NAT 不生效？&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;检查 IP 转发是否开启：&lt;code&gt;cat /proc/sys/net/ipv4/ip_forward&lt;/code&gt;（返回 1 才正确）。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;检查规则顺序：PREROUTING 链规则在前，POSTROUTING 链在后；入站放行规则需匹配映射端口。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;检查网卡名称：确认 &lt;code&gt;-i&lt;/code&gt;（入站）、&lt;code&gt;-o&lt;/code&gt;（出站）网卡名称正确（用 &lt;code&gt;ip addr&lt;/code&gt; 查看）。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;外网能访问映射服务，但内网访问公网 IP 无法访问？&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;原因：内网主机访问网关公网 IP 时，DNAT 生效但返回路径未经过 SNAT，需添加 “内网访问公网 IP 映射” 规则：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;iptables -t nat -A PREROUTING -s 192.168.1.0/24 -d 203.0.113.10 -p tcp --dport 80 -j DNAT --to-destination 192.168.1.200:80&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;复制代码&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;云服务器配置 DNAT 无效？&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;云服务器（阿里云、腾讯云等）的公网 IP 是厂商提供的 “弹性 IP”，需先在云控制台配置 “端口转发” 或 “安全组”，开放对应端口，否则外网流量无法到达服务器。&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;批量删除 NAT 规则？&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;# 清空 nat 表的 PREROUTING 链（DNAT 规则）

iptables -t nat -F PREROUTING

# 清空 nat 表的 POSTROUTING 链（SNAT 规则）

iptables -t nat -F POSTROUTING&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;复制代码&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;

      </description>
    </item>
    
    <item>
      <title>Iptables基础</title>
      <link>http://localhost:8081/docs/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/iptables%E5%9F%BA%E7%A1%80/</link>
      <pubDate>Mon, 29 Dec 2025 11:17:36 +0800</pubDate>
      
      <guid>http://localhost:8081/docs/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/iptables%E5%9F%BA%E7%A1%80/</guid>
      <description>
        
        
        &lt;h2&gt;核心前提说明&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;核心前提说明&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e6%a0%b8%e5%bf%83%e5%89%8d%e6%8f%90%e8%af%b4%e6%98%8e&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;以下命令均需 &lt;strong&gt;root 权限&lt;/strong&gt; 执行（或前缀加 &lt;code&gt;sudo&lt;/code&gt;）。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;iptables 规则默认保存在内存中，重启后失效，配置完成后需执行 “保存命令”（见文末）。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;假设环境：&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;公网网卡：&lt;code&gt;eth0&lt;/code&gt;（可根据实际修改，如 &lt;code&gt;ens33&lt;/code&gt;、&lt;code&gt;eth1&lt;/code&gt;）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;内网网卡：&lt;code&gt;eth1&lt;/code&gt;（内网网段示例：&lt;code&gt;192.168.1.0/24&lt;/code&gt;）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;本地回环：&lt;code&gt;lo&lt;/code&gt;（必须放行，否则影响本地服务通信）&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;场景 1：只允许指定 IP 访问服务器（全局限制）&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;场景-1只允许指定-ip-访问服务器全局限制&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%9c%ba%e6%99%af-1%e5%8f%aa%e5%85%81%e8%ae%b8%e6%8c%87%e5%ae%9a-ip-%e8%ae%bf%e9%97%ae%e6%9c%8d%e5%8a%a1%e5%99%a8%e5%85%a8%e5%b1%80%e9%99%90%e5%88%b6&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;h3&gt;需求&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;需求&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e9%9c%80%e6%b1%82&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;仅允许 &lt;code&gt;192.168.1.100&lt;/code&gt;（内网管理机）和 &lt;code&gt;203.0.113.20&lt;/code&gt;（外网固定 IP）访问服务器所有开放端口，拒绝其他所有 IP。&lt;/p&gt;
&lt;h3&gt;配置命令&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;配置命令&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e9%85%8d%e7%bd%ae%e5%91%bd%e4%bb%a4&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;# 1. 清空现有规则（可选，首次配置建议执行）

iptables -F

iptables -X

# 2. 放行本地回环（必须保留）

iptables -A INPUT -i lo -j ACCEPT

# 3. 放行已建立的连接（避免连接中断，如 SSH 登录后不被踢掉）

iptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT

# 4. 允许指定 IP 访问（添加需要放行的 IP）

iptables -A INPUT -s 192.168.1.100 -j ACCEPT  # 内网管理机

iptables -A INPUT -s 203.0.113.20 -j ACCEPT   # 外网固定 IP

# 5. 拒绝所有其他入站请求（默认策略，放在最后）

iptables -P INPUT DROP&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;复制代码&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3&gt;逻辑解释&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;逻辑解释&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e9%80%bb%e8%be%91%e8%a7%a3%e9%87%8a&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;-s&lt;/code&gt;：指定 “源 IP”（即访问方的 IP）。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;DROP&lt;/code&gt;：默认拒绝所有未匹配的入站流量，安全性最高（需确保已放行必要 IP，否则会失联）。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;若需添加多个 IP，重复执行 &lt;code&gt;iptables -A INPUT -s 目标IP -j ACCEPT&lt;/code&gt; 即可。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;场景 2：公网仅开放 80/443 端口，22 端口仅指定 IP 访问，内网互通&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;场景-2公网仅开放-80443-端口22-端口仅指定-ip-访问内网互通&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%9c%ba%e6%99%af-2%e5%85%ac%e7%bd%91%e4%bb%85%e5%bc%80%e6%94%be-80443-%e7%ab%af%e5%8f%a322-%e7%ab%af%e5%8f%a3%e4%bb%85%e6%8c%87%e5%ae%9a-ip-%e8%ae%bf%e9%97%ae%e5%86%85%e7%bd%91%e4%ba%92%e9%80%9a&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;h3&gt;需求拆解&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;需求拆解&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e9%9c%80%e6%b1%82%e6%8b%86%e8%a7%a3&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;公网（&lt;code&gt;eth0&lt;/code&gt; 网卡）：仅允许 80（HTTP）、443（HTTPS）端口访问，其他端口拒绝。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;22 端口（SSH）：仅允许 &lt;code&gt;192.168.1.100&lt;/code&gt;（内网）和 &lt;code&gt;203.0.113.20&lt;/code&gt;（外网管理 IP）访问。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;内网（&lt;code&gt;192.168.1.0/24&lt;/code&gt; 网段）：所有主机可互通（任意端口、任意协议）。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;放行已建立的连接，避免通信中断。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;配置命令&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;配置命令-1&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e9%85%8d%e7%bd%ae%e5%91%bd%e4%bb%a4-1&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;# 1. 清空现有规则（可选）

iptables -F

iptables -X

# 2. 放行本地回环

iptables -A INPUT -i lo -j ACCEPT

# 3. 放行已建立的连接（关键：允许服务器主动发起的连接返回数据）

iptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT

# 4. 内网互通：允许内网网段（192.168.1.0/24）所有入站流量

iptables -A INPUT -i eth1 -s 192.168.1.0/24 -j ACCEPT  # 按内网网卡限制

# 或（不限制网卡，仅按网段）：iptables -A INPUT -s 192.168.1.0/24 -j ACCEPT

# 5. 22 端口（SSH）：仅允许指定 IP 访问

iptables -A INPUT -p tcp --dport 22 -s 192.168.1.100 -j ACCEPT  # 内网管理机

iptables -A INPUT -p tcp --dport 22 -s 203.0.113.20 -j ACCEPT   # 外网管理 IP

# 6. 公网开放 80/443 端口（TCP 协议）

iptables -A INPUT -i eth0 -p tcp --dport 80 -j ACCEPT   # HTTP

iptables -A INPUT -i eth0 -p tcp --dport 443 -j ACCEPT  # HTTPS

# 7. 默认策略：拒绝所有未匹配的入站流量

iptables -P INPUT DROP

# （可选）放行出站流量（默认通常为 ACCEPT，若需限制可调整）

iptables -P OUTPUT ACCEPT&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;复制代码&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3&gt;关键参数说明&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;关键参数说明&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%85%b3%e9%94%ae%e5%8f%82%e6%95%b0%e8%af%b4%e6%98%8e&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;参数&lt;/th&gt;
          &lt;th&gt;作用&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;-i eth0&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;指定网卡（公网网卡），仅匹配该网卡的流量&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;-p tcp&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;指定协议（TCP，80/443/22 均为 TCP 协议）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;--dport&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;指定 “目标端口”（即服务器开放的端口）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;-s 目标IP&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;指定 “源 IP”（仅允许该 IP 访问对应端口）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;-j ACCEPT&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;匹配后放行流量&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;-m state --state RELATED,ESTABLISHED&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;匹配 “已建立的连接” 或 “与已建立连接相关的流量”（如服务器访问外部后，外部返回的数据）&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;场景 3：补充说明（内网互通的其他实现方式）&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;场景-3补充说明内网互通的其他实现方式&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%9c%ba%e6%99%af-3%e8%a1%a5%e5%85%85%e8%af%b4%e6%98%8e%e5%86%85%e7%bd%91%e4%ba%92%e9%80%9a%e7%9a%84%e5%85%b6%e4%bb%96%e5%ae%9e%e7%8e%b0%e6%96%b9%e5%bc%8f&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;若内网有多网段（如 &lt;code&gt;192.168.1.0/24&lt;/code&gt; 和 &lt;code&gt;192.168.2.0/24&lt;/code&gt;），需放行所有内网网段：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;# 放行 192.168.1.0/24 网段

iptables -A INPUT -s 192.168.1.0/24 -j ACCEPT

# 放行 192.168.2.0/24 网段

iptables -A INPUT -s 192.168.2.0/24 -j ACCEPT&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;复制代码&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;若需允许服务器主动访问内网其他主机（出站流量），确保 &lt;code&gt;OUTPUT&lt;/code&gt; 链策略为 &lt;code&gt;ACCEPT&lt;/code&gt;（默认通常如此）：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;iptables -P OUTPUT ACCEPT&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;复制代码&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;重要操作：保存 iptables 规则（避免重启失效）&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;重要操作保存-iptables-规则避免重启失效&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e9%87%8d%e8%a6%81%e6%93%8d%e4%bd%9c%e4%bf%9d%e5%ad%98-iptables-%e8%a7%84%e5%88%99%e9%81%bf%e5%85%8d%e9%87%8d%e5%90%af%e5%a4%b1%e6%95%88&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;h3&gt;CentOS/RHEL 系统&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;centosrhel-系统&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#centosrhel-%e7%b3%bb%e7%bb%9f&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;# 保存规则到配置文件

service iptables save

# 或

iptables-save &amp;gt; /etc/sysconfig/iptables

# 设置开机自启（确保规则加载）

systemctl enable iptables

systemctl start iptables&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;复制代码&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3&gt;Ubuntu/Debian 系统&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;ubuntudebian-系统&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#ubuntudebian-%e7%b3%bb%e7%bb%9f&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;默认无内置保存工具，需安装 &lt;code&gt;iptables-persistent&lt;/code&gt;：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;# 安装工具

apt-get install -y iptables-persistent

# 保存规则（保存后重启自动加载）

netfilter-persistent save

# 或手动保存到文件

iptables-save &amp;gt; /etc/iptables/rules.v4&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;复制代码&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;验证与调试命令&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;验证与调试命令&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e9%aa%8c%e8%af%81%e4%b8%8e%e8%b0%83%e8%af%95%e5%91%bd%e4%bb%a4&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;# 查看当前 iptables 规则（INPUT 链）

iptables -L INPUT -n --line-numbers

# 测试端口是否可访问（从外部主机执行）

telnet 服务器IP 80    # 测试 80 端口

telnet 服务器IP 22    # 测试 22 端口（仅指定 IP 可通）

# 清空所有规则（出错时紧急恢复）

iptables -F

iptables -X

iptables -P INPUT ACCEPT  # 临时放行所有入站，避免失联&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;复制代码&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;注意事项&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;注意事项&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;先放行关键 IP / 端口&lt;/strong&gt;：配置 &lt;code&gt;DROP&lt;/code&gt; 默认策略前，务必先放行 SSH 管理 IP（如 &lt;code&gt;192.168.1.100&lt;/code&gt;），否则会被踢下线，无法远程恢复。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;网卡名称确认&lt;/strong&gt;：通过 &lt;code&gt;ip addr&lt;/code&gt; 命令查看实际网卡名称（如 &lt;code&gt;ens33&lt;/code&gt;、&lt;code&gt;eth0&lt;/code&gt;），避免配置错误。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;协议匹配&lt;/strong&gt;：80/443/22 均为 TCP 协议，需指定 &lt;code&gt;-p tcp&lt;/code&gt;；若需开放 UDP 端口（如 53 DNS），需改为 &lt;code&gt;-p udp&lt;/code&gt;。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;云服务器安全组&lt;/strong&gt;：若为云服务器（阿里云、腾讯云等），需同时在云厂商的 “安全组” 中开放对应端口，否则 iptables 配置生效但外部仍无法访问。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;

      </description>
    </item>
    
    <item>
      <title>Tcpdump</title>
      <link>http://localhost:8081/docs/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/tcpdump/</link>
      <pubDate>Mon, 29 Dec 2025 11:17:24 +0800</pubDate>
      
      <guid>http://localhost:8081/docs/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/tcpdump/</guid>
      <description>
        
        
        &lt;h2&gt;基础说明&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;基础说明&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%9f%ba%e7%a1%80%e8%af%b4%e6%98%8e&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;&lt;code&gt;tcpdump&lt;/code&gt; 是 Linux 系统中强大的网络抓包工具，支持按 IP 地址、端口号、协议类型等条件过滤数据包，适用于网络故障排查、流量分析等场景。&lt;/p&gt;
&lt;h2&gt;示例&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;示例&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e7%a4%ba%e4%be%8b&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;h3&gt;1. 抓取指定 IP 的数据包&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;1-抓取指定-ip-的数据包&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#1-%e6%8a%93%e5%8f%96%e6%8c%87%e5%ae%9a-ip-%e7%9a%84%e6%95%b0%e6%8d%ae%e5%8c%85&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tcpdump host 10.0.0.5&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;复制代码&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3&gt;2. 抓取指定网段的数据包&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;2-抓取指定网段的数据包&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#2-%e6%8a%93%e5%8f%96%e6%8c%87%e5%ae%9a%e7%bd%91%e6%ae%b5%e7%9a%84%e6%95%b0%e6%8d%ae%e5%8c%85&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tcpdump net 192.168.1.0/24&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;复制代码&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3&gt;3. 抓取指定端口的数据包&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;3-抓取指定端口的数据包&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#3-%e6%8a%93%e5%8f%96%e6%8c%87%e5%ae%9a%e7%ab%af%e5%8f%a3%e7%9a%84%e6%95%b0%e6%8d%ae%e5%8c%85&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tcpdump port &lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;复制代码&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3&gt;4. 抓取多个端口的数据包&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;4-抓取多个端口的数据包&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#4-%e6%8a%93%e5%8f%96%e5%a4%9a%e4%b8%aa%e7%ab%af%e5%8f%a3%e7%9a%84%e6%95%b0%e6%8d%ae%e5%8c%85&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tcpdump port &lt;span class=&#34;m&#34;&gt;80&lt;/span&gt; or port &lt;span class=&#34;m&#34;&gt;443&lt;/span&gt; or port &lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;复制代码&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3&gt;5. 抓取指定 IP + 端口的数据包&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;5-抓取指定-ip--端口的数据包&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#5-%e6%8a%93%e5%8f%96%e6%8c%87%e5%ae%9a-ip--%e7%ab%af%e5%8f%a3%e7%9a%84%e6%95%b0%e6%8d%ae%e5%8c%85&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tcpdump host 192.168.1.10 and port &lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;复制代码&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3&gt;6. 抓包内容保存到文件&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;6-抓包内容保存到文件&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#6-%e6%8a%93%e5%8c%85%e5%86%85%e5%ae%b9%e4%bf%9d%e5%ad%98%e5%88%b0%e6%96%87%e4%bb%b6&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tcpdump host 192.168.1.10 and port &lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt; -w /tmp/test.cap&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;复制代码&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3&gt;7. docker容器内容抓包&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;7-docker容器内容抓包&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#7-docker%e5%ae%b9%e5%99%a8%e5%86%85%e5%ae%b9%e6%8a%93%e5%8c%85&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# 获取容器PID&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker inspect --format &lt;span class=&#34;s2&#34;&gt;&amp;#34;{{ .State.Pid }}&amp;#34;&lt;/span&gt; f6b48371b16d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# 根据容器PID抓网卡eth0包&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;nsenter -n -t &lt;span class=&#34;m&#34;&gt;25235&lt;/span&gt; tcpdump -i eth0 -w /tmp/test.cap&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;复制代码&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;常用辅助选项（提升抓包效率）&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;常用辅助选项提升抓包效率&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%b8%b8%e7%94%a8%e8%be%85%e5%8a%a9%e9%80%89%e9%a1%b9%e6%8f%90%e5%8d%87%e6%8a%93%e5%8c%85%e6%95%88%e7%8e%87&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;选项&lt;/th&gt;
          &lt;th&gt;作用&lt;/th&gt;
          &lt;th&gt;示例&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;-i&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;指定抓包网卡（如 eth0、ens33，&lt;code&gt;any&lt;/code&gt; 表示所有网卡）&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;tcpdump -i eth0 port 80&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;-w&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;将抓包结果保存到文件（后续可用 Wireshark 分析）&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;tcpdump -i any host 192.168.1.10 -w capture.pcap&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;-r&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;读取保存的抓包文件&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;tcpdump -r capture.pcap&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;-n&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;不解析域名（显示 IP 地址，加快抓包速度）&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;tcpdump -n port 443&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;-nn&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;不解析域名和端口名称（显示原始端口号）&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;tcpdump -nn host 203.0.113.5&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;-v&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;显示详细抓包信息（&lt;code&gt;-vv&lt;/code&gt; 更详细，&lt;code&gt;-vvv&lt;/code&gt; 最详细）&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;tcpdump -v tcp port 22&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;-c&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;指定抓包数量（抓够指定数量后自动退出）&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;tcpdump -c 100 port 80&lt;/code&gt;（抓取 100 个包）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;-A&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;以 ASCII 格式显示数据包内容（方便查看 HTTP 等明文数据）&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;tcpdump -A host 192.168.1.10 and port 80&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

      </description>
    </item>
    
  </channel>
</rss>
